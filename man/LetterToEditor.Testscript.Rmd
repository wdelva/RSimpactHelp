---
title: "LetterToEditor.Testscript"
output: html_document
---


```{r, echo = FALSE, cache = FALSE, message = FALSE}
library(RSimpactCyan)
library(RSimpactHelper)
agedist.data.frame <- agedistr.creator(shape = 5, scale = 65)
testinput <- input.params.creator(conception.alpha_base = -2,
                                  population.eyecap.fraction = 0.4,
                                  population.numwomen = 1000,
                                  population.nummen = 1000,
                                  population.simtime = 20,
                                  hivseed.amount = 20,
                                  hivseed.age.min = 15,
                                  hivseed.age.max = 25,
                                  person.agegap.woman.dist.normal.sigma = 1,
                                  person.agegap.man.dist.normal.sigma = 1,
                                  person.eagerness.dist.gamma.b = 30,
                                  formation.hazard.agegapry.gap_factor_woman_exp = -0.5,
                                  formation.hazard.agegapry.gap_factor_man_exp = -0.5,
                                  transmission.param.f1 = 1000,
                                  transmission.param.f2 = 0
                                  )
testoutput <- simpact.run(configParams = testinput,
                          destDir = "temp",
                          agedist = agedist.data.frame)

```

```{r, echo = FALSE, cache = FALSE, message = FALSE}
library(RSimpactHelper)
library(data.table)
library(dplyr)
library(magrittr)
datalist.test <- readthedata(testoutput)
times <- 0:60
prev.df <- data.frame(times = times,
                      prevalence.men = NA,
                      prevalence.women = NA,
                      prevalence.all = NA)
row.number <- 1
for (times in times){
  prevalence.df <- prevalence.calculator(datalist = datalist.test,
                                         agegroup = c(15, 50),
                                         timepoint = times)
  prev.df[row.number, ] <- c(times, prevalence.df$pointprevalence)
  row.number <- row.number + 1
}

agemix.df <- agedif.metric.calculator(datalist = datalist.test,
                                      agegroup = c(15, 30),
                                      timewindow = 10,
                                      timepoint = 30)



matplot(x = prev.df$times,
        y = prev.df[, 2:4],
        type = "s")
legend(x = "bottomright",
       col = 1:3,
       lty = rep(1, 4),
       legend = c("Men", "Women", "Both"))

agemix.df
hist(datalist.test$rtable$AgeGap)
print(datalist.test$ltable)
nrow(datalist.test$rtable) # Total number of relationships
```
